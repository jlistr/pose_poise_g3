query GetProfile($uid: String!) @auth(level: USER) {
  profiles(where: {user: {uid: {eq: $uid}}}) {
    name
    instagram
    avatar
    height
    bust
    waist
    hips
    shoeSize
    dressSize
    hairColor
    eyeColor
    description
    careerGoals
  }
}

mutation CreateUser($uid: String!, $email: String, $now: Timestamp!) @auth(level: USER) {
  user_upsert(data: {
    uid: $uid,
    email: $email,
    createdAt: $now
  })
}

mutation UpsertProfile($uid: String!, $name: String!, $instagram: String, $avatar: String, $height: String!, $bust: String!, $waist: String!, $hips: String!, $shoeSize: String!, $dressSize: String!, $hairColor: String!, $eyeColor: String!, $description: String, $careerGoals: String) @auth(level: USER) {
  profile_upsert(data: {
    user: {uid: $uid},
    name: $name,
    instagram: $instagram,
    avatar: $avatar,
    height: $height,
    bust: $bust,
    waist: $waist,
    hips: $hips,
    shoeSize: $shoeSize,
    dressSize: $dressSize,
    hairColor: $hairColor,
    eyeColor: $eyeColor,
    description: $description,
    careerGoals: $careerGoals
  })
}

query GetPortfolio($uid: String!) @auth(level: USER) {
  portfolios(where: {user: {uid: {eq: $uid}}}) {
    # id removed as it is keyed by user
    isPublic
    settings
    createdAt
    updatedAt
  }
}

query GetShootsForPortfolio($uid: String!) @auth(level: USER) {
  # Since Portfolio is keyed by user, we can filter shoots by portfolio -> user -> uid
  shoots(where: {portfolio: {user: {uid: {eq: $uid}}}}) {
    id
    name
    vibes
    photographer
    studio
    shootImages_on_shoot(orderBy: {order: ASC}) {
      image {
        id
        url
      }
      order
      isVisible
    }
  }
}

mutation UpsertPortfolio($uid: String!, $settings: String!, $isPublic: Boolean!, $now: Timestamp!) @auth(level: USER) {
  portfolio_upsert(data: {
    user: {uid: $uid},
    settings: $settings,
    isPublic: $isPublic,
    createdAt: $now,
    updatedAt: $now
  })
}

mutation DeletePortfolio($uid: String!) @auth(level: USER) {
  portfolio_delete(key: {userUid: $uid})
}

mutation UpsertShoot($id: UUID!, $uid: String!, $name: String!, $vibes: String, $photographer: String, $studio: String, $now: Timestamp!) @auth(level: USER) {
  shoot_upsert(data: {
    id: $id,
    portfolio: {userUid: $uid},
    name: $name,
    vibes: $vibes,
    photographer: $photographer,
    studio: $studio,
    createdAt: $now,
    updatedAt: $now
  })
}

mutation DeleteShoot($id: UUID!) @auth(level: USER) {
  shoot_delete(key: {id: $id})
}

# --- Library Operations ---

query GetLibrary($uid: String!) @auth(level: USER) {
  images(where: {user: {uid: {eq: $uid}}}, orderBy: {uploadedAt: DESC}) {
    id
    url
    uploadedAt
    metadata
  }
}

mutation UpsertImage($id: UUID!, $uid: String!, $url: String!, $now: Timestamp!, $fileHash: String) @auth(level: USER) {
  image_upsert(data: {
    id: $id,
    user: {uid: $uid},
    url: $url,
    uploadedAt: $now,
    fileHash: $fileHash
  })
}

query getImagesByHash($hash: String!) @auth(level: USER) {
  images(where: { fileHash: { eq: $hash } }) {
    id
    url
    user {
       uid
    }
  }
}

mutation DeleteImage($id: UUID!) @auth(level: USER) {
  image_delete(key: {id: $id})
}

mutation AddImageToShoot($shootId: UUID!, $imageId: UUID!, $order: Int!, $isVisible: Boolean = true) @auth(level: USER) {
  shootImage_upsert(data: {
    shoot: {id: $shootId},
    image: {id: $imageId},
    order: $order,
    isVisible: $isVisible
  })
}

# --- Comp Card Operations ---

query GetCompCards($uid: String!) @auth(level: USER) {
  compCards(where: {user: {uid: {eq: $uid}}}, orderBy: {updatedAt: DESC}) {
    id
    layout
    aesthetic
    profileSnapshot
    createdAt
    updatedAt
  }
}

mutation UpsertCompCard($id: UUID!, $uid: String!, $layout: String!, $aesthetic: String!, $profileSnapshot: String!, $now: Timestamp!) @auth(level: USER) {
  compCard_upsert(data: {
    id: $id,
    user: {uid: $uid},
    layout: $layout,
    aesthetic: $aesthetic,
    profileSnapshot: $profileSnapshot,
    createdAt: $now,
    updatedAt: $now
  })
}

mutation DeleteCompCard($id: UUID!) @auth(level: USER) {
  compCard_delete(key: {id: $id})
}